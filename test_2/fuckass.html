<!DOCTYPE html>
<html>
<body>
    <h1>Chat Window</h1>
    <textarea id="log" rows="10" cols="40" readonly></textarea><br>
    <input id="msg" placeholder="Type message" style="width: 300px;">
    <button id="send">Send</button>

<script>
// Create a channel (all windows with same page / origin join)
const channel = new BroadcastChannel("my_chat");

// DOM elements
const log = document.getElementById("log");
const input = document.getElementById("msg");
const sendBtn = document.getElementById("send");

// Utility to append text to chat area
function append(msg) {
    log.value += msg + "\n";
    log.scrollTop = log.scrollHeight;
}

// Send message to all windows (including self, optionally)
sendBtn.onclick = () => {
    const text = input.value;
    if (text.trim() === "") return;

    channel.postMessage({
        sender: self.name || "(unnamed window)",
        text
    });

    input.value = "";
};

// Receive messages
channel.onmessage = (event) => {
    const { sender, text } = event.data;
    append(`${sender}: ${text}`);
};

// Give each window a random name for fun
if (!self.name) self.name = "win-" + Math.floor(Math.random()*10000);
append(`You are ${self.name}`);
</script>
</body>
</html>
